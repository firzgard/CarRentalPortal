@using CRP.Models
@using CRP.Models.Entities
@using CRP.Models.ViewModels

@model CRP.Models.ViewModels.VehicleDetailInfoViewModel
@{
	ViewBag.Title = "Quản lý xe";
	Layout = "~/Views/Shared/_ManagementLayout.cshtml";
}

<div class="row wrapper border-bottom white-bg page-heading">
	<div class="col-md-10"><h2>Thông tin chi tiết của xe</h2></div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
	<div class="row">
		<div class="col-lg-12">
			
			<div class="ibox product-detail">
				<div class="ibox-content">
					<div class="row">
						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Tên</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.Name</p>
								</div>
								<div class="editFiel col-md-8 m-b" style="display:none">
									@Html.TextBoxFor(q => q.Name, new { @type = "text", @class = "form-control", @id = "name"})
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Biển số xe</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.LicenseNumber</p>
								</div>
								<div class="editFiel col-md-8" style="display:none">
									<div class="m-b">
										
										@Html.ValidationMessageFor(m => m.LicenseNumber, "", new { @class = "text-danger" })
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Garage</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.GarageName</p>
								</div>
								<div class="editFiel col-md-8" style="display:none">
									
									@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
									
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Nhóm giá</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.VehicleGroupName</p>
								</div>
								<div class="editFiel col-md-8" style="display:none">
									@Html.DropDownListFor(q => q.VehicleGroupID, this.Model.listGroup, new { @class = "form-control", @id = "groupID" })
								</div>
							</div>
						</div>
						</div>
						<div class="row">
						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Hãng xe</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.BrandName @this.Model.ModelName</p>
								</div>
								<div class="editFiel col-md-8" style="display:none">
									<select id="modelFilter" class="form-control">
										<option></option>
										@foreach (VehicleBrand brand in Model.brandList)
										{
											<optgroup label="@brand.Name">
												@foreach (VehicleModel entry in brand.VehicleModels)
												{
													if (entry.Name != this.Model.ModelName)
													{
														<option value="@(entry.ID)">@(brand.Name)&nbsp;@entry.Name</option>
													}
													else
													{
														<option value="@(entry.ID)" selected>@(brand.Name)&nbsp;@entry.Name</option>
													}
												}
											</optgroup>
										}
									</select>
								</div>
							</div>
						</div>
						</div>
						<div class="row">
						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Năm</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.Year</p>
								</div>
								<div class="editFiel col-md-8" style="display:none">
									@Html.TextBoxFor(q => q.Year, new { @type = "number", @class = "form-control", @id = "year", @max = Constants.MAX_YEAR, @min = Constants.MIN_YEAR})
								</div>
							</div>
						</div>

						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Động cơ</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.Engine</p>
								</div>
								<div class="editFiel col-md-8 m-b" style="display:none">
									<div>
										@Html.TextBoxFor(q => q.Engine, new { @type = "text", @class = "form-control", @id = "engine" })
									</div>
								</div>
							</div>
						</div>
						</div>
						<div class="row">
						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Nhiên liệu</label>
								</div>
								<div class="justRead col-md-8 m-b">
									<p>@this.Model.FuelTypeName</p>
								</div>
								<div class="editFiel col-md-8 m-b" style="display:none">
									<select id="fuelFilter" class="form-control">
										@foreach (KeyValuePair<int, string> entry in Constants.FUEL_TYPE)
										{
											if (@entry.Value != Model.FuelTypeName)
											{
												<option value="@entry.Key">@entry.Value</option>
											}
											else
											{
												<option value="@entry.Key" selected>@entry.Value</option>
											}
										}
									</select>
								</div>
							</div>
						</div>
						
						<div class="col-md-6">
							<div class="row">
								<div class="col-md-4 text-right">
									<label>Hộp số</label>
								</div>
								<div class="justRead col-md-8">
									<p>@this.Model.TransmissionTypeName</p>
								</div>
								<div class="editFiel col-md-8" style="display:none">
									<div id="tranmissionType" class="form-control">
										<div class="form-group row">
											
												@foreach (KeyValuePair<int, string> entry in Constants.TRANSMISSION_TYPE)
												{
													if (@entry.Value != Model.TransmissionTypeName)
													{
														<div class="radio radio-primary col-xs-6 text-center" style="margin: 0 0 3px 0">
															<input value="@entry.Key" id="transmission@(entry.Value)" name="TransName" type="radio">
															<label for="transmission@(entry.Value)" name="TransName">@entry.Value</label>
														</div>
													}
													else
													{
														<div class="radio radio-primary col-xs-6 text-center" style="margin: 0 0 3px 0">
															<input value="@entry.Key" id="transmission@(entry.Value)" name="TransName" type="radio" checked>
															<label for="transmission@(entry.Value)" name="TransName">@entry.Value</label>
														</div>
													}
												}
											
										</div>
										
									</div>
								</div>
							</div>
						</div>
						</div>
						<div class="row">
						<div class="col-md-6">
							<div class="row editFiel" style="display:none"> 
								<div class="col-md-4 text-right">
									<label>Màu</label>
								</div>
								<div class="col-md-8 m-b" style="height: 200px;">
									<div class="form-group row" id="colorFilter">

										<div class="col-xs-12">
											@for (var i = 1; i < Constants.COLOR.Count(); i++)
											{
												if (i != Model.ColorID)
												{
													<div class="color-selector">
														<input id="color@(Constants.COLOR[i])" name="newColor" value="@i" type="radio">
														<label for="color@(Constants.COLOR[i])" style="background-color: @Constants.COLOR[i];"></label>
													</div>
												}
												else
												{
													<div class="color-selector">
														<input id="color@(Constants.COLOR[i])" name="newColor" value="@i" type="radio" checked>
														<label for="color@(Constants.COLOR[i])" style="background-color: @Constants.COLOR[i];"></label>
													</div>
												}
											}
											<div class="color-selector another-color">
												<input id="color0" name="newColor" value="0" type="radio">
												<label for="color0"></label>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<div id="img-div" class="col-md-6">
							<div>
								<div class="row">
									<div class="col-md-4 text-right">
										<label>Hình</label>
									</div>
									<div class="col-md-8">
										<div class="carousel slide m-b" id="carousel1">
											<div class="carousel-inner">
												<div class="item active">
													<img alt="image" class="img-responsive" src="@this.Model.ImageUrls[0]" style="height:300px; width:350px;">
												</div>
												@foreach (string entry in Model.ImageUrls)
												{
													if (Model.ImageUrls.IndexOf(entry) != 0)
													{
														<div class="item">
															<img alt="image" class="img-responsive" src="@entry" style="height:300px; width:350px;">
														</div>
													}
												}

											</div>
											<a data-slide="prev" href="#carousel1" class="left carousel-control">
												<span class="icon-prev"></span>
											</a>
											<a data-slide="next" href="#carousel1" class="right carousel-control">
												<span class="icon-next"></span>
											</a>
										</div>
										@if (Model.ImageUrls.Count < 8)
										{
										 <a id="edit-img" class="btn btn-warning editFiel" style="display:none">Thêm ảnh mới</a>
										}
									</div>
								</div>
							</div>
							
						</div>

						<div class="col-md-6">
							<form action="/Home/SaveUploadedFile/@Model.ID" method="post" enctype="multipart/form-data" class="dropzone" id="dropzoneForm">
								<div class="fallback">
									<input name="file" type="file" multiple />
									<input type="submit" value="Upload" />
								</div>
							</form>
						</div>

					</div>
					<div class="hr-line-dashed"></div>
					<div class="row editFiel" style="display:none">
					
						@foreach (string entry in Model.ImageUrls)
						{
							//using (Html.BeginForm("DeletePic", "VehicleManagement", FormMethod.Get, new { @class = "form-horizontal", role = "form" }))
							//{
							<div class="col-md-3">
								<div class="item">
									<img alt="image" class="img-responsive" src="@entry" style="height:300px; width:350px;">
									<input type="hidden" value="@entry" name="Url" class="imgUrl" />
									<input type="hidden" value="@Model.ID" name="id" id="id" />
									@if (Model.ImageUrls.Count > 4)
									{
										<input type="submit" class="btn btn-success DeleteImage" value="Xóa ảnh này" />
									}
								</div>
							</div>
						   //}
						}
					<input type="hidden" value="" name="maxImg" id="maxImg" />
				</div>
				<div class="hr-line-dashed"></div>
					<div class="text-center">
						<a id="delete-btn" class="btn btn-danger" style="margin:20px">Xóa</a>
						<a id="edit-btn" class="btn btn-info justRead" style="margin:20px">Chỉnh sửa</a>
						<a id="save-btn" class="btn btn-success">Lưu</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="ibox float-e-margins">
		@Html.HiddenFor(q => q.ID, new { @id = "vehicleID" })
		
		<div class="ibox-title">
			<div class="edit-control row">
				<div class="input-group">
					<span class="input-group-addon">Tên xe</span>
					@Html.TextBoxFor(q => q.Name, new { @id = "name", @class = "form-control input-lg", @placeholder = "Tên xe", @style = "color: #000;", required = true })
				</div>
			</div>
			<div id="displayGarageName" class="display-control row">
				<div class ="col-md-6 m-t m-l m-b" style="font-size: 25px;">
					<span>@Model.Name</span>
				</div>
				<div class ="col-md-2 pull-right m-t m-r-lg">
					<a id="btnEditGarage" class ="btn btn-success"><i class ="fa fa-pencil-square-o"></i><span> Chỉnh sửa thông tin</span></a>
				</div>
			</div>
		</div>

		<div class="ibox-content">
			<div class="edit-control form-group">
				<div class="row">
					<div class="col-md-6">
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Biển số xe <span style="color: red">*</span></label>
							</div>
							<div class="col-md-8">
								@Html.TextBoxFor(q => q.LicenseNumber, new { @class = "form-control", @id = "licenseNumber", @maxlength = "50", @minlength = "10" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Dòng xe <span style="color: red">*</span></label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Năm sản xuất <span style="color: red">*</span></label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Garage <span style="color: red">*</span></label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Nhóm xe <span style="color: red">*</span></label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Loại hộp số <span style="color: red">*</span></label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Chi tiết về hộp số</label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Loại nhiên liệu</label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Động cơ</label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4 text-right">
								<label>Màu xe <span style="color: red">*</span></label>
							</div>
							<div class="col-md-8">
								@Html.DropDownListFor(q => q.GarageID, this.Model.listGarage, new { @class = "form-control", @id = "garageID" })
							</div>
						</div>
					</div>

					<div class="col-md-6">
						<div id="vehicleImg" style="background-image:url('#');"></div>
						<!-- Controls -->
						<a class="left carousel-control">
							<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
							<span class="sr-only">Previous</span>
						</a>
						<a class="right carousel-control">
							<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
							<span class="sr-only">Next</span>
						</a>
					</div>

				</div>
				<hr>
				<div class="row">
					<div class="col-md-12">
						<div class="row m-b text-center">
								<h3>Mô tả</h3>
							<div class="col-md-12 text-left">
								@Html.TextAreaFor(q => q.Description, new { @class = "form-control", @id = "description", @rows="20" })
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="display-control row form-group">
				<div class="row">
					<div class="col-md-6">
						<div class="row m-b">
							<div class="col-md-4">
								<label>Biển số xe</label>
							</div>
							<div class="col-md-8">
								@Model.LicenseNumber
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4">
								<label>Dòng xe</label>
							</div>
							<div class="col-md-8">
								@Model.BrandName @Model.ModelName
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4">
								<label>Năm sản xuất</label>
							</div>
							<div class="col-md-8">
								@Model.Year
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4">
								<label>Garage</label>
							</div>
							<div class="col-md-8">
								@Model.GarageName
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4">
								<label>Nhóm xe</label>
							</div>
							<div class="col-md-8">
								@(Model.VehicleGroupName ? Model.VehicleGroupName : "-Không thuộc nhóm nào-")
							</div>
						</div>
						<div class="row m-b">
							<div class="col-md-4">
								<label>Loại hộp số</label>
							</div>
							<div class="col-md-8">
								@Model.TransmissionTypeName
							</div>
						</div>
						@if (@Model.TransmissionDetail != null) {
							<div class="row m-b">
								<div class="col-md-4">
									<label>Chi tiết về hộp số</label>
								</div>
								<div class="col-md-8">
									@Model.TransmissionDetail
								</div>
							</div>
						}
						@if (@Model.FuelTypeName != null) {
							<div class="row m-b">
								<div class="col-md-4">
									<label>Loại nhiên liệu</label>
								</div>
								<div class="col-md-8">
									@Model.FuelTypeName
								</div>
							</div>
						}
						@if (@Model.FuelTypeName != null) {
							<div class="row m-b">
								<div class="col-md-4">
									<label>Động cơ</label>
								</div>
								<div class="col-md-8">
									@Model.FuelTypeName
								</div>
							</div>
						}
						<div class="row m-b">
							<div class="col-md-4">
								<label>Màu xe</label>
							</div>
							<div class="col-md-8">
								<i class="fa fa-circle fa-lg" style="color:@(Model.ColorName)"></i>
							</div>
						</div>
					</div>

					<div class="col-md-6">
						
					</div>

				</div>
				<hr>
				<div class="row">
					<div class="col-md-12">
						<div class="row m-b text-center">
							<div class="col-md-2 text-right">
								<label>Mô tả</label>
							</div>
							<div class="col-md-9 text-left">
								@if (Model.Description != null)
								{
									@Model.Description
								}
								else
								{
									<text>chưa có</text>
								}
							</div>
						</div>
						<hr>
						<div class="row m-b text-center">
							<div class="col-md-2 text-right">
								<label>Điều khoản</label>
							</div>
							<div class="col-md-9 text-left">
								@if (Model.Policy != null)
								{
									@Model.Policy
								}
								else
								{
									<text>chưa có</text>
								}

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="ibox-footer">
			<div>
				<div class="btn-group">
					<button id="activationBtn" class="btn btn-warning" data-toggle="modal" data-target="#customModal"></button>
					<button class="btn btn-danger" data-toggle="modal" data-target="#customModal" data-action="deleteGarage">Xóa garage</button>
				</div>
				<button id="saveChange" class="edit-control btn btn-primary pull-right">Lưu lại</button>
				<button id="cancelChange" class="edit-control btn btn-default pull-right m-r-xs">Hủy bỏ</button>
			</div>
		</div>
	</div>

	<div class="tabs-container">
		<ul class="nav nav-tabs">
			<li class="active"><a data-toggle="tab" href="#tab-booking">Thông tin đặt xe</a></li>
			<li class=""><a data-toggle="tab" href="#tab-review">Thông tin đánh giá</a></li>
		</ul>
		<div class="tab-content">
			<div id="tab-booking" class="tab-pane">
				<div class="panel-body">
					<div class="ibox ibox-content float-e-margins">
						<div class="row">
							<div class="pull-left m-r m-b table-bordered">
								<h3>Thời gian thanh toán</h3>
								<div class="radio">
									<input type="radio" id="rd1" value="all" name="bookingTime" checked>
									<label for="rd1"> Tất cả</label>
								</div>
								<div class="radio">
									<input type="radio" id="rd2" value="past" name="bookingTime">
									<label for="rd2"> Đã qua</label>
								</div>
								<div class="radio">
									<input type="radio" id="rd3" value="future" name="bookingTime">
									<label for="rd3"> Sắp đến</label>
								</div>
							</div>
							<div class="pull-left m-r m-b table-bordered">
								<h3>Trạng thái hóa đơn</h3>
								<div class="checkbox">
									<input type="checkbox" id="isCanceled">
									<label for="isCanceled"> Đã hủy</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="isSelfBooking">
									<label for="isSelfBooking"> Tự đặt</label>
								</div>
							</div>
						</div>
						
						<table class="table table-striped table-bordered table-hover" width="100%" id="bookings"></table>
					</div>
				</div>
			</div>

			<div id="tab-review" class="tab-pane active">
				<div class="panel-body">
					<div class="ibox ibox-content float-e-margins">
						@if (Model.NumOfComment > 0)
						{
							<h2 class="col-md-12 section-header"><b>@(Model.NumOfComment) đánh giá</b> · <span class="rating" data-rating="@Model.Star"></span></h2>
							<div class="col-md-12"><hr /></div>
							<div class="col-md-12">
								<div id="commentContainer"></div>
								<div class="text-center" id="commentPaginator"></div>
							</div>
						}
						else
						{
							<h2 class="col-md-12 section-header"><b>Đánh giá</b></h2>
							<h3 class="col-md-12">Xe này vẫn chưa có đánh giá.</h3>
						}
					</div>
				</div>
			</div>

		</div>
	</div>
	
</div>



<div id="delete-car" class="modal fade" role="dialog">
<div class="modal-dialog">
<div class="modal-content">
	<div class="modal-header" style="background-color:#4CAF50">
		<button type="button" class="close" data-dismiss="modal">&times;</button>
		<h4 class="modal-title" style="color:white">Xóa xe @Html.DisplayFor(q => q.Name)</h4>
	</div>
	<div class="modal-body form-horizontal">
		<p> Bạn có chắc chắn muốn xóa xe này ?</p>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-default" data-dismiss="modal">Hủy</button>
		<button id="agreed-delete" type="button" class="btn btn-primary">Đồng ý</button> 
	</div>
</div>
</div>
</div>

@{ BundleTable.Bundles.Add(new StyleBundle("~/Styles/VehicleDetail")
													  .Include("~/Content/awesome-bootstrap-checkbox.css",
														  "~/Content/chosen.css",
														  "~/Scripts/dropzone/dropzone.css",
														  "~/Scripts/dropzone/basic.css",
														  "~/Content/pageStyle/VehicleDetail.css",
														  "~/Content/select2/select2.css"));
}
@section Styles {
	@Styles.Render("~/Styles/VehicleDetail")
}
@{ BundleTable.Bundles.Add(new ScriptBundle("~/Scripts/VehicleDetail")
											  .Include("~/Scripts/chosen.jquery.js",
												 "~/Scripts/bootstrap.min.js",
												 "~/Scripts/dropzone/dropzone.js",
												 "~/Scripts/select2/select2.full.js",
												 "~/Scripts/pageScript/VehicleDetail.js"));
}
}
@section Scripts {
	<script>
		const MAX_IMG = @Model.ImageUrls.Count;
	</script>

	@Scripts.Render("~/Scripts/VehicleDetail")
	@Scripts.Render("~/bundles/jqueryval")
}